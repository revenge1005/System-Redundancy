## 목차

1-1. [다중화](#1-1-다중화)

1-2. [웹 서버의 다중화 - DNS 라운드로빈](#1-2-웹-서버의-다중화---dns-라운드로빈)

1-3. [웹 서버 다중화 - IPVS를 이용한 로드밸런서](#)

1-4. [L4 스위치의 NAT 구성과 DSR 구성](#)

1-5. [동일 서브넷인 서버를 부하분산할 경우 주의사항](#)

---

# 1-1. 다중화

```
+ 다중화란, 장애가 발생해도 예비 운용장비로 시스템의 기능을 계속할 수 있도록 하는 것을 말한다.
```

### ⓐ 라우터 장애 시의 경우

#### 【 Cold Standby 】

```
+ 예비 운용장비는 사용하지 않고 있다가 현재 운용장비에 장애가 발생하면 예비 운용장비를 연결하는 운용 형태

    - 주의해야할 점은 현재 장비와 예비 장비의 설정은 동일하게 해야한다는 점이다.

    - 라우터와 같은 네트워크 장비라면 운영중에 빈번히 설정을 변경할 일도 없고, 저장할 데이터가 별로 없으므로 Cold Standby가 적절함
```

### ⓑ 웹 서버 장애 시의 경우

#### 【 Hot Standby 】
```
+ 두 대의 서버를 항상 가동시켜 두고 늘 같은 상태로 유지해두는 운용 형태
```

### ⓒ 장애극복(Failover)

```
+ 현재 운용장비에 장애가 발생했을 때 자동으로 예비 운용장비로 처리를 인계하는 것
```

#### 【 가상 IP 주소(VIP) 】
```
+ 현재 운용장비인 웹 서버에는 자신의 IP주소와는 별개로 VIP를 할당해 두고 서비스는 VIP로 제공함
```
#### 【 IP 주소 인계 】
```
+ 현재 운용장비에 장애가 발생했을 때에는 예비 운용장비가 VIP를 인계한다.
```

### ⓓ 장애 검출 (Health Check)
```
+ 정상적으로 장애극복하기 위해서는 현재 운용장비에서 장애가 발생하고 있음을 검출하는 방법
```

#### 【 ICMP 감시 (Layer3) 】

```
+ ICMP의 Echo 요청을 보내서 응답이 돌아오는지를 체크

+ 가장 간단한 방법이지만, 웹서비스가 다운된 경우는 감지할 수 없다.
```

#### 【 포트 감시 (Layer4) 】
```
+ TCP로 접속을 시험해서 접속할 수 있는지 여부를 체크

+ 웹 서비스가 다운된 것은 감지할 수 있지만, 과부화 상태로 응답할 수 없다거나 에러를 반환하는 것은 감지할 수 없다.
```

#### 【 서비스 감시 (Layer7) 】
```
+ 실제로 HTTP 요청 등을 보내서 정상적인 응답이 들어오는지 체크

+ 대부분의 이상을 감지할 수 있지만, 경우에 따라서는 서버에 부하를 유발할 수도 있다.
```

#### 【 웹 서버의 헬스체크 】
```
+ "서버 장애에 의한 서비스 중지"는 정상적으로 검출하기 위해서는 "서비스 감시"를 이용한다

+ 서비스 감시를 이용하는 이유는 서버의 전원이 켜져 있어서 ICMP 응답이 돌아오더라도 서비스가 정상적으로 동작하고 있다고 할 수 없기 때문임
```  

#### 【 라우터의 헬스체크 】
```
+ "라우터 장애에 의한 서비스 정지"를 검출하기 위해서는 ICMP 감시를 이용한다.

+ 라우터에 대한 감시를 하는 것이 아니라 확실히 패킷을 전송할 수 있는가이므로 웹 서버에게 통신할 수 있는 상태인지를 확인할 수 있으면 됨
```

---

# 1-2. 웹 서버의 다중화 -  DNS 라운드로빈 

### ⓐ DNS를 이용해서 하나의 서비스에 여러 대의 서버를 분산시키는 방법
```
+ 유저 A와 B는 각각 DNS 서버에 www.test.com의 IP 주소를 질의하면 DNS 서버는 "x.x.x.1", "x.x.x.2"라는 서로 다른 IP 주소를 반환한다.

+ 그 결과 A는 "x.x.x.1"로, B는 "x.x.x.2"로 접속한다.

+ DNS 서버는 동일한 이름으로 여러 레코드를 등록시키면 질의할 때마다 다른 결과를 반환한다.

+ 이 동작을 이용함으로써 여러 대의 서버에 처리를 분산시킬 수가 있다.
```

### ⓑ DNS 라운드로빈 문제
```
① 서버의 수만큼 글로벌 주소가 필요

  + 수많은 서버로 부하분산하기 위해서는 IP주소를 많이 얻을 수 있는 서비스를 이용할 필요가 있다.

② 균등하게 분산되는 것은 아님 
    
  + "모바일 사이트에서 문제가 되는 경우"

    - 스마트폰으로부터의 접속은 캐리어 게이트웨이라고 하는 프록시 서버를 경우한다.

    - 프록시 서버에서는 이름변환 결과가 일정시간 동안 캐싱되므로 같은 프록시 서버를 경유하는 접속은 항상 같은 서버로 전달된다.

    - 따라서 균등하게 접속이 분산되지 않고 특정 서버만 처리가 집중할 가능성이 있다.

  + "PC 웹 브라우저"

    - PC 웹브라우저도 DNS 질의 결과를 캐싱하기 때문에 균등학 부하분산되지 않는다.

    - DNS 레코드의 TTL을 짧게 설정함으로써 어느 정도 개선할 수는 있지만, TTL에 따라 캐시를 해제하는 것은 아니므로 주의할 필요가 있다.
```