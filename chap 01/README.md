# 1. 다중화

+ 다중화란, 장애가 발생해도 예비 운용장비로 시스템의 기능을 계속할 수 있도록 하는 것을 말한다.

## (1) 라우터 장애 시의 경우

### 【Cold Standby】

```
+ 예비 운용장비는 사용하지 않고 있다가 현재 운용장비에 장애가 발생하면 예비 운용장비를 연결하는 운용 형태

+ 주의해야할 점은 현재 장비와 예비 장비의 설정은 동일하게 해야한다는 점이다.

+ 라우터와 같은 네트워크 장비라면 운영중에 빈번히 설정을 변경할 일도 없고, 저장할 데이터가 별로 없으므로 Cold Standby가 적절함
```

## (2) 웹 서버 장애 시의 경우

### 【Hot Standby】

    - 두 대의 서버를 항상 가동시켜 두고 늘 같은 상태로 유지해두는 운용 형태

### (3) 장애극복(Failover)

+ 현재 운용장비에 장애가 발생했을 때 자동으로 예비 운용장비로 처리를 인계하는 것

+ **가상 IP 주소(VIP)**

    - 현재 운용장비인 웹 서버에는 자신의 IP주소와는 별개로 VIP를 할당해 두고 서비스는 VIP로 제공한다.

+ **IP 주소 인계**

    - 현재 운용장비에 장애가 발생했을 때에는 예비 운용장비가 VIP를 인계한다.

### (4) 장애 검출 (Health Check)

+ 정상적으로 장애극복하기 위해서는 현재 운용장비에서 장애가 발생하고 있음을 검출하는 방법

+ **ICMP 감시 (Layer3)**

    - ICMP의 Echo 요청을 보내서 응답이 돌아오는지를 체크

    - 가장 간단한 방법이지만, 웹서비스가 다운된 경우는 감지할 수 없다.

+ **포트 감시 (Layer4)**

    - TCP로 접속을 시험해서 접속할 수 있는지 여부를 체크

    - 웹 서비스가 다운된 것은 감지할 수 있지만, 과부화 상태로 응답할 수 없다거나 에러를 반환하는 것은 감지할 수 없다.

+ **서비스 감시 (Layer7)**

    - 실제로 HTTP 요청 등을 보내서 정상적인 응답이 들어오는지 체크

    - 대부분의 이상을 감지할 수 있지만, 경우에 따라서는 서버에 부하를 유발할 수도 있다.
    
+ **웹 서버의 헬스체크**

    - "서버 장애에 의한 서비스 중지"는 정상적으로 검출하기 위해서는 "서비스 감시"를 이용한다

    - 서비스 감시를 이용하는 이유는 서버의 전원이 켜져 있어서 ICMP 응답이 돌아오더라도 웹서비스가 정상적으로 동작하고 있다고는 할 수 없기 때문이다.
    
+ **라우터의 헬스체크**

    - "라우터 장애에 의한 서비스 정지"를 검출하기 위해서는 ICMP 감시를 이용한다.

    - 다만, 라우터에 대해 ICMP 감시를 하는 것이 아닌 확인하고자 하는 것은 라우터가 확실히 패킷을 전송할 수 있는가이므로 웹 서버가 인터넷과 통신할 수 있는 상태인지를 확인할 수 있으면 된다.


